{% extends 'test_tracking/base.html' %}

{% block content %}
<div class="mb-4">
    <div class="d-flex justify-content-between align-items-center">
        <h1>{{ test_run.name }}</h1>
        <span class="badge {% if test_run.completed_at %}bg-success{% else %}bg-warning{% endif %} fs-5">
            {{ test_run.completed_at|yesno:"完了,実行中" }}
        </span>
    </div>
    <p class="text-muted">
        スイート: <a href="{% url 'suite_detail' test_run.suite.id %}">{{ test_run.suite.name }}</a> |
        実行者: {{ test_run.executed_by }} |
        環境: {{ test_run.environment }}
    </p>
    <p class="text-muted">
        開始: {{ test_run.started_at|date:"Y/m/d H:i" }}
        {% if test_run.completed_at %}
        | 完了: {{ test_run.completed_at|date:"Y/m/d H:i" }}
        {% endif %}
    </p>
</div>

<div class="row mb-4">
    <div class="col-md-3">
        <div class="card">
            <div class="card-body text-center">
                <h6 class="card-title">合格</h6>
                <h2 class="text-success">{{ pass_count }}</h2>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card">
            <div class="card-body text-center">
                <h6 class="card-title">不合格</h6>
                <h2 class="text-danger">{{ fail_count }}</h2>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card">
            <div class="card-body text-center">
                <h6 class="card-title">ブロック</h6>
                <h2 class="text-warning">{{ blocked_count }}</h2>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card">
            <div class="card-body text-center">
                <h6 class="card-title">スキップ</h6>
                <h2 class="text-secondary">{{ skipped_count }}</h2>
            </div>
        </div>
    </div>
</div>

<div class="card mb-4">
    <div class="card-header">
        <h5 class="card-title mb-0">実行結果一覧</h5>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table class="table">
                <thead>
                    <tr>
                        <th>テストケース</th>
                        <th>結果</th>
                        <th>実際の結果</th>
                        <th>備考</th>
                        <th>実行日時</th>
                    </tr>
                </thead>
                <tbody>
                    {% for execution in test_run.executions.all %}
                    <tr>
                        <td>
                            <a href="{% url 'case_detail' execution.test_case.id %}">
                                {{ execution.test_case.title }}
                            </a>
                        </td>
                        <td>
                            <span class="badge {% if execution.result == 'PASS' %}bg-success{% elif execution.result == 'FAIL' %}bg-danger{% elif execution.result == 'BLOCKED' %}bg-warning{% else %}bg-secondary{% endif %}">
                                {{ execution.get_result_display }}
                            </span>
                        </td>
                        <td>{{ execution.actual_result|linebreaks|truncatewords:30 }}</td>
                        <td>{{ execution.notes|truncatewords:10 }}</td>
                        <td>{{ execution.executed_at|date:"Y/m/d H:i" }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

{% if test_run.description %}
<div class="card">
    <div class="card-header">
        <h5 class="card-title mb-0">説明</h5>
    </div>
    <div class="card-body">
        {{ test_run.description|linebreaks }}
    </div>
</div>
{% endif %}
{% endblock %}
